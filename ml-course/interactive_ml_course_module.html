<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Adventure: Save MegaMart with Data Science | 数据科学拯救零售巨头</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #1e293b;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s, visibility 0.5s;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loader {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Main Container */
        .main-container {
            min-height: 100vh;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        }
        
        /* Navigation */
        .navigation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 15px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-title {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-progress {
            flex: 1;
            max-width: 400px;
            margin: 0 30px;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.1);
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        /* Chapter Container */
        .chapter {
            display: none;
            padding-top: 80px;
            min-height: 100vh;
            animation: fadeIn 0.5s;
        }
        
        .chapter.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Hero Section */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }
        
        .hero-title {
            font-size: 3em;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero-subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Content Section */
        .content-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 30px;
        }
        
        /* Story Card */
        .story-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .story-card::before {
            content: attr(data-emoji);
            position: absolute;
            top: -30px;
            right: -30px;
            font-size: 120px;
            opacity: 0.1;
        }
        
        .story-title {
            font-size: 2em;
            color: #1e293b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .story-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .story-content {
            line-height: 1.8;
            font-size: 1.1em;
            color: #475569;
        }
        
        .crisis-alert {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            animation: alertPulse 2s infinite;
        }
        
        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        
        /* Interactive Elements */
        .interactive-demo {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid #e2e8f0;
        }
        
        .demo-title {
            font-size: 1.5em;
            color: #1e293b;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .control-label {
            font-weight: 600;
            color: #475569;
            margin-bottom: 10px;
            display: block;
        }
        
        .slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #cbd5e0 0%, #667eea var(--value), #cbd5e0 var(--value));
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        .slider:hover {
            opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.5);
        }
        
        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        /* Code Block */
        .code-container {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .code-title {
            color: #94a3b8;
            font-weight: 600;
        }
        
        .run-btn {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .run-btn:hover {
            transform: scale(1.05);
        }
        
        .code-output {
            background: #0f172a;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* Visualization */
        .viz-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            min-height: 400px;
        }
        
        /* Quiz Section */
        .quiz-container {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .quiz-question {
            font-size: 1.2em;
            color: #1e293b;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .quiz-options {
            display: grid;
            gap: 15px;
        }
        
        .quiz-option {
            background: white;
            border: 2px solid #cbd5e0;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }
        
        .quiz-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(5px);
        }
        
        .quiz-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .quiz-option.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
            animation: correctBounce 0.5s;
        }
        
        .quiz-option.incorrect {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
            animation: shake 0.5s;
        }
        
        @keyframes correctBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* Floating Action Button */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }
        
        .fab {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: transform 0.3s;
            color: white;
            font-size: 24px;
        }
        
        .fab:hover {
            transform: scale(1.1);
        }
        
        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: -400px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: right 0.5s ease;
            z-index: 2000;
            max-width: 350px;
        }
        
        .achievement-popup.show {
            right: 30px;
        }
        
        .achievement-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .achievement-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .achievement-title {
            font-weight: bold;
            color: #1e293b;
            font-size: 1.1em;
        }
        
        .achievement-desc {
            color: #64748b;
            font-size: 0.95em;
        }
        
        /* Tommy's Lemonade Stand */
        .lemonade-game {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }
        
        .lemonade-game::before {
            content: '🍋';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 100px;
            opacity: 0.3;
            transform: rotate(-15deg);
        }
        
        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .game-day {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .day-header {
            font-weight: bold;
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .day-stats {
            display: grid;
            gap: 8px;
            font-size: 0.95em;
            color: #78350f;
        }
        
        /* Business Impact Calculator */
        .impact-calculator {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .impact-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .impact-card:hover {
            transform: translateY(-5px);
        }
        
        .impact-value {
            font-size: 2em;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 5px;
        }
        
        .impact-label {
            color: #15803d;
            font-size: 0.9em;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2em;
            }
            
            .story-card {
                padding: 25px;
            }
            
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
        
        /* Typing Effect */
        .typing-text {
            display: inline-block;
        }
        
        /* Particle Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            from {
                transform: translateY(100vh) translateX(0);
            }
            to {
                transform: translateY(-100vh) translateX(100px);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <h2 style="color: white; margin-top: 30px;">Loading ML Adventure...</h2>
        <p style="color: rgba(255,255,255,0.8); margin-top: 10px;">Preparing your journey from crisis to victory</p>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Navigation -->
        <nav class="navigation">
            <div class="nav-content">
                <div class="nav-title">
                    <span>🚀</span>
                    <span>ML Module 2: Sales Prediction</span>
                </div>
                <div class="nav-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="mainProgress"></div>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" onclick="previousChapter()">← Previous</button>
                    <button class="nav-btn" onclick="nextChapter()">Next →</button>
                    <button class="nav-btn" onclick="showChapterMenu()">📑 Chapters</button>
                </div>
            </div>
        </nav>
        
        <!-- Particles Background -->
        <div class="particles" id="particles"></div>
        
        <!-- Chapter 1: The Crisis -->
        <div class="chapter active" id="chapter1">
            <div class="hero-section">
                <h1 class="hero-title">📉 Monday Morning Crisis at MegaMart</h1>
                <p class="hero-subtitle">
                    <span class="typing-text" id="heroText"></span>
                </p>
            </div>
            
            <div class="content-section">
                <div class="story-card" data-emoji="😰">
                    <div class="story-title">
                        <div class="story-icon">📱</div>
                        <span>The Urgent Message</span>
                    </div>
                    <div class="story-content">
                        <p>It's 7:45 AM on a Monday morning in Chicago. Sarah Chen, the newly appointed Chief Analytics Officer at MegaMart, stares at her computer screen in disbelief.</p>
                        
                        <div class="crisis-alert">
                            <h3>⚠️ WEEKEND DISASTER REPORT</h3>
                            <p><strong>Michigan Avenue Store:</strong> Ran out of AirPods Pro on Saturday</p>
                            <p><strong>Lost Sales:</strong> 300+ customers turned away</p>
                            <p><strong>Revenue Impact:</strong> -$180,000</p>
                            <p><strong>Meanwhile in Naperville:</strong> 500 units sitting unsold!</p>
                        </div>
                        
                        <p style="margin-top: 20px;">The CEO's message pops up on Slack:</p>
                        <div style="background: #1e293b; color: #10b981; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace;">
                            "Sarah, we lost $180,000 this weekend alone. Our traditional forecasting predicted equal inventory at both stores. This CAN'T happen again. Fix this."
                        </div>
                        
                        <p>Sarah takes a deep breath and opens her Python notebook. "Time to show them what machine learning can really do," she thinks.</p>
                        
                        <p style="font-size: 1.2em; font-weight: bold; color: #667eea; margin-top: 30px; text-align: center;">
                            🎯 Today, YOU are Sarah. Let's solve this crisis together!
                        </p>
                    </div>
                </div>
                
                <!-- Interactive Business Impact Calculator -->
                <div class="interactive-demo">
                    <h3 class="demo-title">💰 Calculate the Real Cost of Bad Predictions</h3>
                    <div class="control-panel">
                        <div class="control-item">
                            <label class="control-label">
                                📦 Units Predicted
                                <span class="value-display" id="unitsPredicted">100</span>
                            </label>
                            <input type="range" class="slider" id="predictionSlider" min="0" max="500" value="100">
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                🛒 Actual Demand
                                <span class="value-display" id="actualDemand">400</span>
                            </label>
                            <input type="range" class="slider" id="demandSlider" min="0" max="500" value="400">
                        </div>
                    </div>
                    <div class="impact-grid">
                        <div class="impact-card">
                            <div class="impact-value" id="lostRevenue">$43,200</div>
                            <div class="impact-label">Lost Revenue</div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-value" id="customerLost">75</div>
                            <div class="impact-label">Customers Lost Forever</div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-value" id="accuracyRate">25%</div>
                            <div class="impact-label">Prediction Accuracy</div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-value" id="yearlyImpact">$15.8M</div>
                            <div class="impact-label">Annual Impact</div>
                        </div>
                    </div>
                </div>
                
                <!-- Quiz Section -->
                <div class="quiz-container">
                    <div class="quiz-question">
                        🤔 Before we dive into ML, what do you think is the main problem with MegaMart's current system?
                    </div>
                    <div class="quiz-options">
                        <div class="quiz-option" onclick="checkQuizAnswer(this, 'wrong')">
                            The products are too expensive
                        </div>
                        <div class="quiz-option" onclick="checkQuizAnswer(this, 'wrong')">
                            The stores are too far apart
                        </div>
                        <div class="quiz-option" onclick="checkQuizAnswer(this, 'correct')">
                            The prediction model doesn't account for location-specific patterns
                        </div>
                        <div class="quiz-option" onclick="checkQuizAnswer(this, 'wrong')">
                            The CEO is too demanding
                        </div>
                    </div>
                </div>
                
                <button class="run-btn" style="width: 100%; padding: 15px; font-size: 1.1em; margin-top: 30px;" onclick="goToChapter(2)">
                    Start Your ML Journey →
                </button>
            </div>
        </div>
        
        <!-- Chapter 2: Understanding Linear Regression -->
        <div class="chapter" id="chapter2">
            <div class="hero-section" style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);">
                <h1 class="hero-title">🍋 Tommy's Lemonade Stand</h1>
                <p class="hero-subtitle">Let's understand Linear Regression through a simple story</p>
            </div>
            
            <div class="content-section">
                <div class="story-card" data-emoji="🥤">
                    <div class="story-title">
                        <div class="story-icon">👦</div>
                        <span>Meet 10-Year-Old Tommy</span>
                    </div>
                    <div class="story-content">
                        <p>Before we tackle MegaMart's complex problem, let's understand linear regression through Tommy's lemonade stand. Tommy noticed something interesting: on hot days, he sells more lemonade!</p>
                    </div>
                </div>
                
                <!-- Tommy's Interactive Game -->
                <div class="lemonade-game">
                    <h3 style="color: #92400e; margin-bottom: 20px;">🎮 Help Tommy Find the Pattern!</h3>
                    
                    <div class="game-board">
                        <div class="game-day">
                            <div class="day-header">📅 Day 1 - Monday</div>
                            <div class="day-stats">
                                <span>🌡️ Temperature: 70°F</span>
                                <span>🥤 Cups Sold: 10</span>
                                <span>💰 Profit: $10</span>
                            </div>
                        </div>
                        <div class="game-day">
                            <div class="day-header">📅 Day 2 - Tuesday</div>
                            <div class="day-stats">
                                <span>🌡️ Temperature: 85°F</span>
                                <span>🥤 Cups Sold: 23</span>
                                <span>💰 Profit: $23</span>
                            </div>
                        </div>
                        <div class="game-day">
                            <div class="day-header">📅 Day 3 - Wednesday</div>
                            <div class="day-stats">
                                <span>🌡️ Temperature: 75°F</span>
                                <span>🥤 Cups Sold: 14</span>
                                <span>💰 Profit: $14</span>
                            </div>
                        </div>
                        <div class="game-day">
                            <div class="day-header">📅 Day 4 - Thursday</div>
                            <div class="day-stats">
                                <span>🌡️ Temperature: 90°F</span>
                                <span>🥤 Cups Sold: 28</span>
                                <span>💰 Profit: $28</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 10px;">
                        <h4 style="color: #92400e;">🤔 Tommy's Discovery Challenge</h4>
                        <p style="color: #78350f; margin: 10px 0;">If tomorrow will be 80°F, how many cups should Tommy prepare?</p>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <input type="number" id="tommyGuess" placeholder="Your guess..." style="flex: 1; padding: 10px; border: 2px solid #fed7aa; border-radius: 8px;">
                            <button onclick="checkTommyGuess()" style="background: #f59e0b; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">Check!</button>
                        </div>
                        <div id="tommyFeedback" style="margin-top: 15px; padding: 15px; border-radius: 8px; display: none;"></div>
                    </div>
                </div>
                
                <!-- The Math Behind It -->
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">🧮 Tommy's Linear Regression Discovery</span>
                        <button class="run-btn" onclick="runTommyCode()">▶ Run Code</button>
                    </div>
                    <pre><code class="language-python">import numpy as np
import matplotlib.pyplot as plt

# Tommy's data
temperatures = [70, 85, 75, 90]  # °F
cups_sold = [10, 23, 14, 28]

# Calculate the relationship (simplified linear regression)
avg_temp = np.mean(temperatures)
avg_cups = np.mean(cups_sold)

# Find the slope (how much sales change per degree)
numerator = sum((t - avg_temp) * (c - avg_cups) 
                for t, c in zip(temperatures, cups_sold))
denominator = sum((t - avg_temp) ** 2 for t in temperatures)
slope = numerator / denominator

# Find the intercept (base sales)
intercept = avg_cups - slope * avg_temp

print(f"🎯 Tommy's Magic Formula:")
print(f"Cups = {intercept:.2f} + {slope:.2f} × Temperature")
print(f"\nFor every 1°F increase, Tommy sells {slope:.2f} more cups!")

# Predict for 80°F
prediction = intercept + slope * 80
print(f"\n📊 Prediction for 80°F: {prediction:.1f} cups")</code></pre>
                    <div class="code-output" id="tommyOutput" style="display: none;"></div>
                </div>
                
                <!-- Visual Explanation -->
                <div class="viz-container" id="tommyViz"></div>
                
                <!-- Connect to Sarah's Problem -->
                <div class="story-card" style="background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);">
                    <div class="story-title">
                        <div class="story-icon">💡</div>
                        <span>The Aha Moment!</span>
                    </div>
                    <div class="story-content">
                        <p style="font-size: 1.1em; line-height: 1.8;">
                            <strong>Tommy's simple formula is EXACTLY what Sarah needs!</strong> Instead of temperature affecting lemonade sales, Sarah has:
                        </p>
                        <ul style="margin: 20px 0; line-height: 2;">
                            <li>🌡️ Weather affecting store traffic</li>
                            <li>📅 Day of week affecting shopping patterns</li>
                            <li>💰 Prices affecting demand</li>
                            <li>📱 Social media affecting product popularity</li>
                            <li>🎯 Location affecting customer demographics</li>
                        </ul>
                        <p style="font-size: 1.1em; color: #0284c7;">
                            The principle is the same: find the pattern, create the formula, make predictions!
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chapter 3: Building the Model -->
        <div class="chapter" id="chapter3">
            <div class="hero-section" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">
                <h1 class="hero-title">🛠️ Building Sarah's ML Model</h1>
                <p class="hero-subtitle">Transform MegaMart's data into accurate predictions</p>
            </div>
            
            <div class="content-section">
                <!-- Data Exploration -->
                <div class="interactive-demo">
                    <h3 class="demo-title">📊 MegaMart's Sales Data Explorer</h3>
                    <div class="control-panel">
                        <div class="control-item">
                            <label class="control-label">
                                📍 Store Location
                            </label>
                            <select id="storeSelect" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #cbd5e0;">
                                <option>Michigan Avenue (Downtown)</option>
                                <option>Naperville (Suburban)</option>
                                <option>O'Hare (Airport)</option>
                            </select>
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                📅 Time Period
                            </label>
                            <select id="periodSelect" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #cbd5e0;">
                                <option>Last 7 Days</option>
                                <option>Last 30 Days</option>
                                <option>Last Quarter</option>
                            </select>
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                🏷️ Product Category
                            </label>
                            <select id="categorySelect" style="width: 100%; padding: 8px; border-radius: 6px; border: 2px solid #cbd5e0;">
                                <option>Electronics</option>
                                <option>Clothing</option>
                                <option>Groceries</option>
                            </select>
                        </div>
                    </div>
                    <button class="run-btn" style="width: 100%; margin-top: 20px;" onclick="exploreData()">
                        🔍 Explore Data Patterns
                    </button>
                </div>
                
                <!-- Data Visualization -->
                <div class="viz-container" id="dataExplorationViz"></div>
                
                <!-- Feature Engineering -->
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">🔧 Feature Engineering for MegaMart</span>
                        <button class="run-btn" onclick="runFeatureEngineering()">▶ Run Code</button>
                    </div>
                    <pre><code class="language-python">import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_absolute_error, r2_score

# Load MegaMart data (simulated)
print("📊 Loading MegaMart Sales Data...")
print("="*50)

# Create features that capture business patterns
features = {
    'temperature': 75,           # Weather data
    'day_of_week': 'Monday',    # Weekly patterns
    'is_weekend': 0,             # Weekend flag
    'is_campaign': 1,            # Marketing campaign active
    'competitor_sale': 0,        # Competitor having sale
    'social_buzz': 150,          # Social media mentions
    'avg_price': 249,            # Average product price
    'days_to_holiday': 45,       # Days until next major holiday
}

print("🔧 Engineering Features:")
print("-"*50)

# Cyclical encoding for time features
features['day_sin'] = np.sin(2 * np.pi * 1 / 7)  # Monday = 1
features['day_cos'] = np.cos(2 * np.pi * 1 / 7)
features['month_sin'] = np.sin(2 * np.pi * 10 / 12)  # October
features['month_cos'] = np.cos(2 * np.pi * 10 / 12)

# Interaction features
features['weekend_campaign'] = features['is_weekend'] * features['is_campaign']
features['price_sensitivity'] = features['avg_price'] * features['competitor_sale']

# Display engineered features
for feature, value in features.items():
    print(f"  • {feature}: {value}")

print("\n✨ Total Features: ", len(features))
print("🎯 Ready to train the model!")</code></pre>
                    <div class="code-output" id="featureOutput" style="display: none;"></div>
                </div>
                
                <!-- Model Training -->
                <div class="code-container">
                    <div class="code-header">
                        <span class="code-title">🤖 Training the Linear Regression Model</span>
                        <button class="run-btn" onclick="runModelTraining()">▶ Run Code</button>
                    </div>
                    <pre><code class="language-python"># Train the model
print("🤖 TRAINING LINEAR REGRESSION MODEL")
print("="*50)

# Simulated training process
X_train_size = 292
X_test_size = 73

print(f"📚 Training set: {X_train_size} days of data")
print(f"🧪 Test set: {X_test_size} days of data")
print("\n⏳ Training in progress...")

# Simulate training (in real scenario, this would be actual sklearn code)
import time
for i in range(3):
    print(f"   Iteration {i+1}/3... ", end="")
    time.sleep(0.5)
    print("✓")

print("\n✅ Training complete!")
print("\n📈 MODEL PERFORMANCE:")
print("="*50)

# Results
train_mae = 487.23
test_mae = 512.45
train_r2 = 0.891
test_r2 = 0.878

print(f"Training Set:")
print(f"  MAE: ${train_mae:,.2f}")
print(f"  R² Score: {train_r2:.3f}")
print(f"  Accuracy: {100 - (train_mae/10000*100):.1f}%")

print(f"\nTest Set (Unseen Data):")
print(f"  MAE: ${test_mae:,.2f}")
print(f"  R² Score: {test_r2:.3f}")
print(f"  Accuracy: {100 - (test_mae/10000*100):.1f}%")

print("\n🔍 TOP 5 MOST IMPORTANT FEATURES:")
print("="*50)
important_features = [
    ('sales_lag_1', 312.45, 'Yesterday\'s momentum'),
    ('is_weekend', 287.23, 'Weekend shopping surge'),
    ('temperature', 198.67, 'Weather impact'),
    ('social_buzz', 156.89, 'Viral product trends'),
    ('days_to_holiday', 142.34, 'Holiday shopping urgency')
]

for feature, impact, description in important_features:
    print(f"  {feature}: +${impact:.2f} per unit - {description}")</code></pre>
                    <div class="code-output" id="modelOutput" style="display: none;"></div>
                </div>
                
                <!-- Model Performance Visualization -->
                <div class="viz-container" id="modelPerformanceViz"></div>
                
                <!-- Business Impact -->
                <div class="impact-calculator">
                    <h3 style="color: #15803d; margin-bottom: 20px;">💰 Business Impact of Your ML Model</h3>
                    <div class="impact-grid">
                        <div class="impact-card">
                            <div class="impact-value">94.9%</div>
                            <div class="impact-label">Prediction Accuracy</div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-value">$2.4M</div>
                            <div class="impact-label">Annual Savings</div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-value">87%</div>
                            <div class="impact-label">Stockout Reduction</div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-value">156%</div>
                            <div class="impact-label">ROI First Year</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chapter 4: Making Predictions -->
        <div class="chapter" id="chapter4">
            <div class="hero-section" style="background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);">
                <h1 class="hero-title">🔮 Making Tomorrow's Prediction</h1>
                <p class="hero-subtitle">Use your model to solve the real crisis</p>
            </div>
            
            <div class="content-section">
                <!-- Real-time Prediction Tool -->
                <div class="interactive-demo">
                    <h3 class="demo-title">🎯 MegaMart Sales Predictor</h3>
                    <div class="control-panel">
                        <div class="control-item">
                            <label class="control-label">
                                🌡️ Tomorrow's Temperature
                                <span class="value-display" id="tempValue">75°F</span>
                            </label>
                            <input type="range" class="slider" id="tempSlider" min="50" max="100" value="75">
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                📅 Day of Week
                            </label>
                            <select id="daySelect" style="width: 100%; padding: 8px; border-radius: 6px;">
                                <option>Monday</option>
                                <option>Tuesday</option>
                                <option>Wednesday</option>
                                <option>Thursday</option>
                                <option>Friday</option>
                                <option selected>Saturday</option>
                                <option>Sunday</option>
                            </select>
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                📱 Social Media Buzz
                                <span class="value-display" id="buzzValue">100</span>
                            </label>
                            <input type="range" class="slider" id="buzzSlider" min="0" max="500" value="100">
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                💰 Average Price
                                <span class="value-display" id="priceValue">$249</span>
                            </label>
                            <input type="range" class="slider" id="priceSlider" min="199" max="299" value="249">
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                🎯 Marketing Campaign
                            </label>
                            <div style="display: flex; gap: 20px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="campaign" value="1"> Yes
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="campaign" value="0" checked> No
                                </label>
                            </div>
                        </div>
                        <div class="control-item">
                            <label class="control-label">
                                🏪 Store Location
                            </label>
                            <select id="storeLocationSelect" style="width: 100%; padding: 8px; border-radius: 6px;">
                                <option>Michigan Avenue</option>
                                <option>Naperville</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="run-btn" style="width: 100%; margin-top: 30px; padding: 15px; font-size: 1.1em;" onclick="makePrediction()">
                        🔮 Generate Prediction & Recommendations
                    </button>
                </div>
                
                <!-- Prediction Results -->
                <div class="story-card" id="predictionResults" style="display: none; background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);">
                    <div class="story-title">
                        <div class="story-icon">📊</div>
                        <span>Prediction Results</span>
                    </div>
                    <div class="story-content" id="predictionContent">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
                
                <!-- Action Plan -->
                <div class="story-card" id="actionPlan" style="display: none;">
                    <div class="story-title">
                        <div class="story-icon">📋</div>
                        <span>Recommended Action Plan</span>
                    </div>
                    <div class="story-content" id="actionContent">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chapter 5: Victory -->
        <div class="chapter" id="chapter5">
            <div class="hero-section" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">
                <h1 class="hero-title">🎉 Victory! Crisis Solved!</h1>
                <p class="hero-subtitle">Sarah's ML model saves MegaMart millions</p>
            </div>
            
            <div class="content-section">
                <div class="story-card" data-emoji="🏆">
                    <div class="story-title">
                        <div class="story-icon">📈</div>
                        <span>The Results Are In!</span>
                    </div>
                    <div class="story-content">
                        <h3>One Week Later...</h3>
                        <p>Sarah implemented the ML model across all MegaMart stores. The results exceeded everyone's expectations:</p>
                        
                        <div class="impact-grid" style="margin: 30px 0;">
                            <div class="impact-card">
                                <div class="impact-value" style="color: #10b981;">94.7%</div>
                                <div class="impact-label">Prediction Accuracy</div>
                            </div>
                            <div class="impact-card">
                                <div class="impact-value" style="color: #10b981;">-89%</div>
                                <div class="impact-label">Stockout Incidents</div>
                            </div>
                            <div class="impact-card">
                                <div class="impact-value" style="color: #10b981;">-76%</div>
                                <div class="impact-label">Excess Inventory</div>
                            </div>
                            <div class="impact-card">
                                <div class="impact-value" style="color: #10b981;">+4.2%</div>
                                <div class="impact-label">Customer Satisfaction</div>
                            </div>
                        </div>
                        
                        <div style="background: #10b981; color: white; padding: 20px; border-radius: 12px; margin: 30px 0;">
                            <h3>CEO's Message:</h3>
                            <p style="font-size: 1.1em; line-height: 1.8;">
                                "Sarah, your ML model didn't just solve our inventory problem - it transformed how we think about data. You've saved us $2.4M annually and improved customer satisfaction. You're promoted to Chief Data Science Officer!"
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Your Certificate -->
                <div class="story-card" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white;">
                    <div class="story-title" style="color: white;">
                        <div class="story-icon" style="background: white; color: #f59e0b;">🏅</div>
                        <span>Your Achievement Certificate</span>
                    </div>
                    <div class="story-content" style="text-align: center; padding: 40px;">
                        <h2 style="font-size: 2.5em; margin-bottom: 20px;">Certificate of Completion</h2>
                        <p style="font-size: 1.3em; margin-bottom: 30px;">
                            This certifies that<br>
                            <strong style="font-size: 1.5em; display: block; margin: 20px 0;">
                                [YOUR NAME]
                            </strong>
                            has successfully completed<br>
                            <strong>Module 2: Linear Regression for Business Analytics</strong>
                        </p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 40px 0;">
                            <div>
                                <div style="font-size: 2em; font-weight: bold;">100%</div>
                                <div>Completion Rate</div>
                            </div>
                            <div>
                                <div style="font-size: 2em; font-weight: bold;">A+</div>
                                <div>Final Grade</div>
                            </div>
                            <div>
                                <div style="font-size: 2em; font-weight: bold;">🌟🌟🌟🌟🌟</div>
                                <div>5 Stars</div>
                            </div>
                        </div>
                        <button class="run-btn" style="background: white; color: #f59e0b; padding: 15px 40px; font-size: 1.1em;" onclick="downloadCertificate()">
                            📥 Download Certificate
                        </button>
                    </div>
                </div>
                
                <!-- Next Steps -->
                <div class="story-card">
                    <div class="story-title">
                        <div class="story-icon">🚀</div>
                        <span>Your Next Challenge</span>
                    </div>
                    <div class="story-content">
                        <h3>What You've Mastered:</h3>
                        <ul style="line-height: 2; margin: 20px 0;">
                            <li>✅ Understanding business problems that ML can solve</li>
                            <li>✅ Building linear regression models from scratch</li>
                            <li>✅ Feature engineering for better predictions</li>
                            <li>✅ Evaluating models with business metrics</li>
                            <li>✅ Translating technical results to business value</li>
                        </ul>
                        
                        <h3 style="margin-top: 30px;">Preview: Module 3 - Customer Churn Prediction</h3>
                        <p style="margin: 20px 0; line-height: 1.8;">
                            Sarah faces a new crisis: MegaMart is losing 1,000 customers per month to Amazon. Can she predict which customers will leave and save them with targeted interventions? You'll learn classification algorithms and save even more money!
                        </p>
                        
                        <button class="run-btn" style="width: 100%; padding: 15px; font-size: 1.1em;">
                            Continue to Module 3 →
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <div class="fab-container">
            <div class="fab" onclick="showHint()">💡</div>
        </div>
        
        <!-- Achievement Popup -->
        <div class="achievement-popup" id="achievementPopup">
            <div class="achievement-header">
                <div class="achievement-icon" id="achievementIcon">🏆</div>
                <div>
                    <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
                    <div class="achievement-desc" id="achievementDesc">You've completed your first prediction</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentChapter = 1;
        let totalChapters = 5;
        let achievements = [];
        let userScore = 0;
        let predictions = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                initializeApp();
            }, 2000);
        });
        
        function initializeApp() {
            // Initialize typing effect
            initTypingEffect();
            
            // Create particles
            createParticles();
            
            // Initialize sliders
            initializeSliders();
            
            // Initialize first visualization
            setTimeout(() => {
                createInitialVisualization();
            }, 1000);
        }
        
        // Typing effect for hero text
        function initTypingEffect() {
            const text = "Your mission: Save MegaMart $2.4M using Machine Learning";
            const element = document.getElementById('heroText');
            if (element) {
                new Typed('#heroText', {
                    strings: [text],
                    typeSpeed: 40,
                    showCursor: true,
                    cursorChar: '|'
                });
            }
        }
        
        // Create particle background
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // Initialize sliders
        function initializeSliders() {
            // Prediction slider
            const predictionSlider = document.getElementById('predictionSlider');
            if (predictionSlider) {
                predictionSlider.addEventListener('input', function() {
                    document.getElementById('unitsPredicted').textContent = this.value;
                    calculateBusinessImpact();
                });
            }
            
            // Demand slider
            const demandSlider = document.getElementById('demandSlider');
            if (demandSlider) {
                demandSlider.addEventListener('input', function() {
                    document.getElementById('actualDemand').textContent = this.value;
                    calculateBusinessImpact();
                });
            }
            
            // Temperature slider
            const tempSlider = document.getElementById('tempSlider');
            if (tempSlider) {
                tempSlider.addEventListener('input', function() {
                    document.getElementById('tempValue').textContent = this.value + '°F';
                });
            }
            
            // Buzz slider
            const buzzSlider = document.getElementById('buzzSlider');
            if (buzzSlider) {
                buzzSlider.addEventListener('input', function() {
                    document.getElementById('buzzValue').textContent = this.value;
                });
            }
            
            // Price slider
            const priceSlider = document.getElementById('priceSlider');
            if (priceSlider) {
                priceSlider.addEventListener('input', function() {
                    document.getElementById('priceValue').textContent = '$' + this.value;
                });
            }
        }
        
        // Calculate business impact
        function calculateBusinessImpact() {
            const predicted = parseInt(document.getElementById('predictionSlider').value);
            const actual = parseInt(document.getElementById('demandSlider').value);
            
            let lostRevenue = 0;
            let customersLost = 0;
            
            if (predicted < actual) {
                // Stockout scenario
                const missed = actual - predicted;
                lostRevenue = missed * 249 * 0.7; // Lost profit
                customersLost = Math.floor(missed * 0.25); // 25% don't return
            } else {
                // Overstock scenario
                const excess = predicted - actual;
                lostRevenue = excess * 180 * 0.1; // Holding costs
            }
            
            const accuracy = Math.max(0, 100 - Math.abs(predicted - actual) / actual * 100);
            const yearlyImpact = lostRevenue * 365;
            
            document.getElementById('lostRevenue').textContent = lostRevenue > 0 ? `$${lostRevenue.toLocaleString()}` : '+$0';
            document.getElementById('customerLost').textContent = customersLost;
            document.getElementById('accuracyRate').textContent = accuracy.toFixed(1) + '%';
            document.getElementById('yearlyImpact').textContent = yearlyImpact > 1000000 ? 
                `$${(yearlyImpact/1000000).toFixed(1)}M` : 
                `$${(yearlyImpact/1000).toFixed(0)}K`;
            
            // Color code based on performance
            document.getElementById('accuracyRate').style.color = accuracy > 80 ? '#10b981' : '#ef4444';
        }
        
        // Quiz answer checking
        function checkQuizAnswer(element, result) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            if (result === 'correct') {
                element.classList.add('correct');
                showAchievement('🎯', 'Quick Learner', 'Correctly identified the problem!');
                updateProgress(20);
            } else {
                element.classList.add('incorrect');
            }
        }
        
        // Tommy's guess checking
        function checkTommyGuess() {
            const guess = parseInt(document.getElementById('tommyGuess').value);
            const correct = 18; // Calculated from the pattern
            const feedback = document.getElementById('tommyFeedback');
            
            feedback.style.display = 'block';
            
            if (Math.abs(guess - correct) <= 2) {
                feedback.style.background = '#d1fae5';
                feedback.style.color = '#065f46';
                feedback.innerHTML = `🎉 Excellent! The formula predicts ${correct} cups. You found the pattern!`;
                showAchievement('🧮', 'Pattern Finder', 'Discovered the linear relationship!');
            } else {
                feedback.style.background = '#fee2e2';
                feedback.style.color = '#991b1b';
                feedback.innerHTML = `Not quite. Hint: Look for the pattern between temperature and sales. Try again!`;
            }
        }
        
        // Run Tommy's code
        function runTommyCode() {
            const output = document.getElementById('tommyOutput');
            output.style.display = 'block';
            output.innerHTML = `🎯 Tommy's Magic Formula:
Cups = -52.00 + 0.87 × Temperature

For every 1°F increase, Tommy sells 0.87 more cups!

📊 Prediction for 80°F: 17.6 cups`;
            
            // Create visualization
            createTommyVisualization();
        }
        
        // Create Tommy's visualization
        function createTommyVisualization() {
            const temps = [70, 85, 75, 90];
            const cups = [10, 23, 14, 28];
            
            // Generate regression line
            const xLine = [];
            const yLine = [];
            for (let t = 65; t <= 95; t++) {
                xLine.push(t);
                yLine.push(-52 + 0.87 * t);
            }
            
            const trace1 = {
                x: temps,
                y: cups,
                mode: 'markers',
                name: 'Actual Sales',
                marker: {
                    size: 12,
                    color: '#f59e0b'
                }
            };
            
            const trace2 = {
                x: xLine,
                y: yLine,
                mode: 'lines',
                name: 'Prediction Line',
                line: {
                    color: '#667eea',
                    width: 3
                }
            };
            
            const layout = {
                title: 'Tommy\'s Lemonade Sales Pattern',
                xaxis: { title: 'Temperature (°F)' },
                yaxis: { title: 'Cups Sold' },
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot('tommyViz', [trace1, trace2], layout);
        }
        
        // Feature engineering code
        function runFeatureEngineering() {
            const output = document.getElementById('featureOutput');
            output.style.display = 'block';
            output.innerHTML = `📊 Loading MegaMart Sales Data...
==================================================

🔧 Engineering Features:
--------------------------------------------------
  • temperature: 75
  • day_of_week: Monday
  • is_weekend: 0
  • is_campaign: 1
  • competitor_sale: 0
  • social_buzz: 150
  • avg_price: 249
  • days_to_holiday: 45
  • day_sin: 0.781
  • day_cos: 0.623
  • month_sin: -0.866
  • month_cos: 0.5
  • weekend_campaign: 0
  • price_sensitivity: 0

✨ Total Features: 14
🎯 Ready to train the model!`;
        }
        
        // Model training code
        function runModelTraining() {
            const output = document.getElementById('modelOutput');
            output.style.display = 'block';
            
            let outputText = `🤖 TRAINING LINEAR REGRESSION MODEL
==================================================
📚 Training set: 292 days of data
🧪 Test set: 73 days of data

⏳ Training in progress...`;
            
            output.innerHTML = outputText;
            
            // Simulate training progress
            setTimeout(() => {
                outputText += `
   Iteration 1/3... ✓`;
                output.innerHTML = outputText;
            }, 500);
            
            setTimeout(() => {
                outputText += `
   Iteration 2/3... ✓`;
                output.innerHTML = outputText;
            }, 1000);
            
            setTimeout(() => {
                outputText += `
   Iteration 3/3... ✓

✅ Training complete!

📈 MODEL PERFORMANCE:
==================================================
Training Set:
  MAE: $487.23
  R² Score: 0.891
  Accuracy: 95.1%

Test Set (Unseen Data):
  MAE: $512.45
  R² Score: 0.878
  Accuracy: 94.9%

🔍 TOP 5 MOST IMPORTANT FEATURES:
==================================================
  sales_lag_1: +$312.45 per unit - Yesterday's momentum
  is_weekend: +$287.23 per unit - Weekend shopping surge
  temperature: +$198.67 per unit - Weather impact
  social_buzz: +$156.89 per unit - Viral product trends
  days_to_holiday: +$142.34 per unit - Holiday shopping urgency`;
                
                output.innerHTML = outputText;
                
                // Create performance visualization
                createModelPerformanceVisualization();
                
                showAchievement('🤖', 'Model Builder', 'Successfully trained your first ML model!');
            }, 1500);
        }
        
        // Model performance visualization
        function createModelPerformanceVisualization() {
            // Actual vs Predicted
            const days = Array.from({length: 30}, (_, i) => i + 1);
            const actual = days.map(() => 10000 + Math.random() * 2000 - 1000);
            const predicted = actual.map(a => a + (Math.random() - 0.5) * 1000);
            
            const trace1 = {
                x: days,
                y: actual,
                mode: 'lines',
                name: 'Actual Sales',
                line: { color: '#10b981', width: 2 }
            };
            
            const trace2 = {
                x: days,
                y: predicted,
                mode: 'lines',
                name: 'Predicted Sales',
                line: { color: '#667eea', width: 2, dash: 'dash' }
            };
            
            const layout = {
                title: 'Model Performance: Actual vs Predicted Sales',
                xaxis: { title: 'Days' },
                yaxis: { title: 'Sales ($)' },
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot('modelPerformanceViz', [trace1, trace2], layout);
        }
        
        // Explore data
        function exploreData() {
            const store = document.getElementById('storeSelect').value;
            const period = document.getElementById('periodSelect').value;
            
            // Create data visualization
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const downtown = [8500, 8200, 8100, 8900, 11200, 14500, 13200];
            const suburban = [6200, 5900, 5800, 6400, 7800, 9200, 8600];
            
            const trace1 = {
                x: days,
                y: store.includes('Michigan') ? downtown : suburban,
                type: 'bar',
                marker: {
                    color: '#667eea'
                }
            };
            
            const layout = {
                title: `Sales Pattern: ${store}`,
                xaxis: { title: 'Day of Week' },
                yaxis: { title: 'Sales ($)' },
                height: 400
            };
            
            Plotly.newPlot('dataExplorationViz', [trace1], layout);
        }
        
        // Make prediction
        function makePrediction() {
            const temp = document.getElementById('tempSlider').value;
            const day = document.getElementById('daySelect').value;
            const buzz = document.getElementById('buzzSlider').value;
            const price = document.getElementById('priceSlider').value;
            const campaign = document.querySelector('input[name="campaign"]:checked').value;
            const store = document.getElementById('storeLocationSelect').value;
            
            // Calculate prediction (simplified)
            let baseSales = store.includes('Michigan') ? 12000 : 8000;
            baseSales *= (1 + (temp - 70) * 0.01); // Temperature effect
            baseSales *= day === 'Saturday' || day === 'Sunday' ? 1.4 : 1.0; // Weekend effect
            baseSales *= (1 + buzz / 1000); // Social buzz effect
            baseSales *= (1 - (price - 249) / 500); // Price effect
            baseSales *= campaign === '1' ? 1.3 : 1.0; // Campaign effect
            
            const prediction = Math.round(baseSales);
            const units = Math.round(prediction / 249);
            
            // Show results
            document.getElementById('predictionResults').style.display = 'block';
            document.getElementById('predictionContent').innerHTML = `
                <h3>📊 Prediction for ${store}</h3>
                <p style="font-size: 1.2em; margin: 20px 0;">
                    <strong>Expected Sales: $${prediction.toLocaleString()}</strong><br>
                    <strong>Units to Stock: ${units} AirPods Pro</strong>
                </p>
                <p>Confidence Interval: $${(prediction * 0.95).toLocaleString()} - $${(prediction * 1.05).toLocaleString()}</p>
                <p style="color: #10b981; margin-top: 20px;">
                    ✅ This prediction is 94.7% accurate based on historical performance
                </p>
            `;
            
            // Show action plan
            document.getElementById('actionPlan').style.display = 'block';
            document.getElementById('actionContent').innerHTML = `
                <ol style="line-height: 2;">
                    <li><strong>Inventory:</strong> Order ${units} units for ${store}</li>
                    <li><strong>Staffing:</strong> Schedule ${Math.ceil(units/50)} sales associates</li>
                    <li><strong>Marketing:</strong> ${campaign === '1' ? 'Campaign active - expect 30% boost' : 'Consider launching campaign for 30% boost'}</li>
                    <li><strong>Pricing:</strong> ${price < 249 ? 'Discount active - monitor competitor response' : 'Current price optimal'}</li>
                    <li><strong>Risk Management:</strong> Keep ${Math.ceil(units * 0.1)} units as safety stock</li>
                </ol>
            `;
            
            showAchievement('🔮', 'Fortune Teller', 'Made your first ML prediction!');
        }
        
        // Navigation functions
        function goToChapter(chapter) {
            currentChapter = chapter;
            updateChapterVisibility();
            updateProgress(chapter * 20);
            window.scrollTo(0, 0);
        }
        
        function nextChapter() {
            if (currentChapter < totalChapters) {
                goToChapter(currentChapter + 1);
            }
        }
        
        function previousChapter() {
            if (currentChapter > 1) {
                goToChapter(currentChapter - 1);
            }
        }
        
        function updateChapterVisibility() {
            document.querySelectorAll('.chapter').forEach(ch => {
                ch.classList.remove('active');
            });
            document.getElementById(`chapter${currentChapter}`).classList.add('active');
        }
        
        // Progress tracking
        function updateProgress(amount) {
            const currentWidth = parseInt(document.getElementById('mainProgress').style.width) || 0;
            const newWidth = Math.min(100, currentWidth + amount);
            document.getElementById('mainProgress').style.width = newWidth + '%';
            
            if (newWidth === 100) {
                showAchievement('🎓', 'Module Complete!', 'You\'ve mastered Linear Regression!');
            }
        }
        
        // Achievement system
        function showAchievement(icon, title, description) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementIcon').textContent = icon;
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
            
            achievements.push({icon, title, description});
        }
        
        // Show hint
        function showHint() {
            const hints = [
                "💡 Try adjusting the sliders to see how different factors affect predictions!",
                "💡 The best models combine multiple features for better accuracy.",
                "💡 Remember: A 1% improvement in accuracy can mean millions in savings!",
                "💡 Real ML models can use hundreds of features for predictions.",
                "💡 The key to ML success is understanding the business problem first."
            ];
            
            const hint = hints[Math.floor(Math.random() * hints.length)];
            alert(hint);
        }
        
        // Chapter menu
        function showChapterMenu() {
            const chapters = [
                'Chapter 1: The Crisis',
                'Chapter 2: Understanding Linear Regression',
                'Chapter 3: Building the Model',
                'Chapter 4: Making Predictions',
                'Chapter 5: Victory!'
            ];
            
            const selected = prompt('Select a chapter (1-5):\n\n' + chapters.map((c, i) => `${i+1}. ${c}`).join('\n'));
            if (selected && selected >= 1 && selected <= 5) {
                goToChapter(parseInt(selected));
            }
        }
        
        // Download certificate
        function downloadCertificate() {
            alert('🎉 Certificate downloaded! Share your achievement on LinkedIn!');
            showAchievement('🏅', 'Certified!', 'ML Expert certification earned!');
        }
        
        // Initial visualization
        function createInitialVisualization() {
            // This would create the initial data visualization
            // Implemented based on the specific needs
        }
    </script>
</body>
</html>
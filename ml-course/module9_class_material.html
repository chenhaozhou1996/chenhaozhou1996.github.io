<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 9: Time Series Analysis - Interactive Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Georgia, serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .journey-progress {
            background: rgba(255, 255, 255, 0.2);
            height: 30px;
            border-radius: 15px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .content {
            padding: 40px;
        }
        
        .scenario-box {
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        
        .interactive-section {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .control-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .control-item label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #003366;
        }
        
        .slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #0366d6;
            cursor: pointer;
        }
        
        .value-display {
            text-align: center;
            font-size: 1.2em;
            color: #0366d6;
            margin-top: 5px;
        }
        
        canvas {
            width: 100% !important;
            height: auto !important;
            max-height: 400px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #0366d6;
        }
        
        .metric-label {
            color: #666;
            margin-top: 5px;
        }
        
        .decision-point {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 20px;
            margin: 30px 0;
            border-radius: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: #0366d6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: #0256c7;
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
        
        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
        
        .challenge-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .hint-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            display: none;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1em;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #0366d6;
            border-bottom: 3px solid #0366d6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .cost-impact {
            font-size: 1.5em;
            color: #4caf50;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0366d6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ Operation: Inventory Revolution</h1>
            <p style="font-size: 1.2em;">Transform $75M in losses into $50M in savings through predictive analytics</p>
            <div class="journey-progress">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
        </div>
        
        <div class="content">
            <!-- Crisis Introduction -->
            <div class="scenario-box">
                <h2>ðŸ“Š URGENT: Board Meeting in 2 Hours</h2>
                <p>You are the newly appointed Chief Supply Chain Officer at MegaRetail Corp, a global retail giant with:</p>
                <ul style="margin: 15px 0; margin-left: 20px;">
                    <li>20,000 SKUs across 500 locations</li>
                    <li>$2 billion in inventory holdings</li>
                    <li>$75 million annual losses from poor forecasting</li>
                    <li>Customer satisfaction dropping 15% due to stockouts</li>
                </ul>
                <p><strong>Your Mission:</strong> Build a time series forecasting system that will revolutionize inventory management and save the company from a hostile takeover.</p>
            </div>
            
            <!-- Phase 1: Understanding the Pattern -->
            <div class="interactive-section">
                <h2>Phase 1: Decode the Demand Patterns</h2>
                <p>First, let's understand what's driving our inventory chaos. Analyze three years of sales data to identify patterns.</p>
                
                <div class="tab-container">
                    <button class="tab active" onclick="switchTab('decomposition')">Decomposition</button>
                    <button class="tab" onclick="switchTab('trends')">Trend Analysis</button>
                    <button class="tab" onclick="switchTab('seasonality')">Seasonality</button>
                </div>
                
                <div id="decomposition" class="tab-content active">
                    <canvas id="decompositionChart"></canvas>
                    <div class="control-panel">
                        <div class="control-item">
                            <label>Smoothing Window</label>
                            <input type="range" class="slider" id="smoothingSlider" min="1" max="12" value="3">
                            <div class="value-display" id="smoothingValue">3 months</div>
                        </div>
                        <div class="control-item">
                            <label>Decomposition Type</label>
                            <select id="decompType" onchange="updateDecomposition()">
                                <option value="additive">Additive</option>
                                <option value="multiplicative">Multiplicative</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="trends" class="tab-content">
                    <canvas id="trendChart"></canvas>
                    <p style="margin-top: 15px;"><strong>Insight:</strong> The trend shows 12% annual growth, requiring strategic capacity planning.</p>
                </div>
                
                <div id="seasonality" class="tab-content">
                    <canvas id="seasonalityChart"></canvas>
                    <p style="margin-top: 15px;"><strong>Discovery:</strong> 300% demand spike during holidays - we're leaving $25M on the table!</p>
                </div>
            </div>
            
            <!-- Decision Point 1 -->
            <div class="decision-point">
                <h3>ðŸŽ¯ Quick Decision Required</h3>
                <p>Based on the decomposition analysis, which component is causing the most inventory problems?</p>
                <div class="button-group">
                    <button onclick="makeDecision('trend', 1)">Growing Trend (12% YoY)</button>
                    <button onclick="makeDecision('seasonal', 1)">Seasonal Spikes (300%)</button>
                    <button onclick="makeDecision('irregular', 1)">Random Fluctuations</button>
                </div>
                <div id="decision1Feedback" class="success-message"></div>
            </div>
            
            <!-- Phase 2: Build the Forecasting Model -->
            <div class="interactive-section">
                <h2>Phase 2: Deploy ARIMA Intelligence</h2>
                <p>Now let's build a sophisticated ARIMA model to predict future demand with precision.</p>
                
                <div class="control-panel">
                    <div class="control-item">
                        <label>AR Terms (p)</label>
                        <input type="range" class="slider" id="arSlider" min="0" max="5" value="2">
                        <div class="value-display" id="arValue">2</div>
                    </div>
                    <div class="control-item">
                        <label>Differencing (d)</label>
                        <input type="range" class="slider" id="diffSlider" min="0" max="2" value="1">
                        <div class="value-display" id="diffValue">1</div>
                    </div>
                    <div class="control-item">
                        <label>MA Terms (q)</label>
                        <input type="range" class="slider" id="maSlider" min="0" max="5" value="1">
                        <div class="value-display" id="maValue">1</div>
                    </div>
                    <div class="control-item">
                        <label>Seasonal Period</label>
                        <select id="seasonalPeriod" onchange="updateARIMA()">
                            <option value="0">None</option>
                            <option value="7">Weekly</option>
                            <option value="30">Monthly</option>
                            <option value="365">Yearly</option>
                        </select>
                    </div>
                </div>
                
                <canvas id="arimaChart"></canvas>
                
                <div class="metric-cards">
                    <div class="metric-card">
                        <div class="metric-value" id="mapeValue">8.2%</div>
                        <div class="metric-label">MAPE (Accuracy)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="aicValue">1842.5</div>
                        <div class="metric-label">AIC Score</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="forecastValue">$2.3M</div>
                        <div class="metric-label">Next Month Forecast</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="confidenceValue">Â±$180K</div>
                        <div class="metric-label">95% Confidence</div>
                    </div>
                </div>
                
                <button onclick="optimizeARIMA()">ðŸŽ¯ Auto-Optimize Parameters</button>
                <div class="loading-spinner" id="optimizingSpinner"></div>
            </div>
            
            <!-- Challenge 1: Handle Special Events -->
            <div class="challenge-box">
                <h3>âš¡ Challenge: Black Friday Approaching!</h3>
                <p>Historical data shows 500% demand spike during Black Friday week. Your current model doesn't account for this.</p>
                <p><strong>Task:</strong> Adjust the forecast to prevent $10M in lost sales.</p>
                
                <div class="control-panel">
                    <div class="control-item">
                        <label>Event Multiplier</label>
                        <input type="range" class="slider" id="eventSlider" min="1" max="10" value="1" step="0.5">
                        <div class="value-display" id="eventValue">1.0x</div>
                    </div>
                    <div class="control-item">
                        <label>Ramp-up Days</label>
                        <input type="range" class="slider" id="rampSlider" min="0" max="30" value="7">
                        <div class="value-display" id="rampValue">7 days</div>
                    </div>
                </div>
                
                <canvas id="eventChart"></canvas>
                <div class="cost-impact" id="eventImpact">Impact: $0</div>
                
                <button onclick="showHint('event')">ðŸ’¡ Need a Hint?</button>
                <div id="eventHint" class="hint-box">
                    <strong>Hint:</strong> Last year's Black Friday saw 5x normal demand. Consider ramping up inventory 2 weeks before to capture early shoppers.
                </div>
            </div>
            
            <!-- Phase 3: Optimize Safety Stock -->
            <div class="interactive-section">
                <h2>Phase 3: Dynamic Safety Stock Optimization</h2>
                <p>Traditional safety stock wastes $35M annually. Let's make it dynamic based on forecast uncertainty.</p>
                
                <div class="control-panel">
                    <div class="control-item">
                        <label>Service Level Target</label>
                        <input type="range" class="slider" id="serviceSlider" min="90" max="99.9" value="95" step="0.1">
                        <div class="value-display" id="serviceValue">95.0%</div>
                    </div>
                    <div class="control-item">
                        <label>Lead Time (days)</label>
                        <input type="range" class="slider" id="leadSlider" min="1" max="30" value="7">
                        <div class="value-display" id="leadValue">7 days</div>
                    </div>
                    <div class="control-item">
                        <label>Holding Cost (%)</label>
                        <input type="range" class="slider" id="holdingSlider" min="10" max="40" value="25">
                        <div class="value-display" id="holdingValue">25%</div>
                    </div>
                </div>
                
                <canvas id="safetyStockChart"></canvas>
                
                <div class="metric-cards">
                    <div class="metric-card">
                        <div class="metric-value" id="stockValue">$450K</div>
                        <div class="metric-label">Safety Stock Value</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="stockoutRisk">2.1%</div>
                        <div class="metric-label">Stockout Risk</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="holdingCost">$112K</div>
                        <div class="metric-label">Annual Holding Cost</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="savingsValue">$28M</div>
                        <div class="metric-label">Annual Savings</div>
                    </div>
                </div>
            </div>
            
            <!-- Decision Point 2 -->
            <div class="decision-point">
                <h3>ðŸŽ¯ Critical Trade-off Decision</h3>
                <p>The CFO wants to minimize inventory investment. The CCO wants zero stockouts. What's your recommendation?</p>
                <div class="button-group">
                    <button onclick="makeDecision('aggressive', 2)">Aggressive: 90% Service, $40M Savings</button>
                    <button onclick="makeDecision('balanced', 2)">Balanced: 95% Service, $30M Savings</button>
                    <button onclick="makeDecision('conservative', 2)">Conservative: 99% Service, $20M Savings</button>
                </div>
                <div id="decision2Feedback" class="warning-message"></div>
            </div>
            
            <!-- Phase 4: Multi-SKU Optimization -->
            <div class="interactive-section">
                <h2>Phase 4: Portfolio-Wide Optimization</h2>
                <p>Scale your solution across all 20,000 SKUs using hierarchical forecasting and correlation analysis.</p>
                
                <canvas id="portfolioChart"></canvas>
                
                <div class="control-panel">
                    <div class="control-item">
                        <label>SKU Category</label>
                        <select id="categorySelect" onchange="updatePortfolio()">
                            <option value="all">All Categories</option>
                            <option value="electronics">Electronics (30% of revenue)</option>
                            <option value="clothing">Clothing (25% of revenue)</option>
                            <option value="grocery">Grocery (20% of revenue)</option>
                            <option value="home">Home & Garden (25% of revenue)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>ABC Classification</label>
                        <select id="abcSelect" onchange="updatePortfolio()">
                            <option value="all">All Items</option>
                            <option value="a">A Items (80% value)</option>
                            <option value="b">B Items (15% value)</option>
                            <option value="c">C Items (5% value)</option>
                        </select>
                    </div>
                </div>
                
                <div class="metric-cards">
                    <div class="metric-card pulse">
                        <div class="metric-value" id="totalSKUs">20,000</div>
                        <div class="metric-label">Total SKUs</div>
                    </div>
                    <div class="metric-card pulse">
                        <div class="metric-value" id="optimizedSKUs">0</div>
                        <div class="metric-label">Optimized SKUs</div>
                    </div>
                    <div class="metric-card pulse">
                        <div class="metric-value" id="correlatedPairs">1,247</div>
                        <div class="metric-label">Correlated Pairs</div>
                    </div>
                    <div class="metric-card pulse">
                        <div class="metric-value" id="portfolioSavings">$0</div>
                        <div class="metric-label">Portfolio Savings</div>
                    </div>
                </div>
                
                <button onclick="runPortfolioOptimization()">ðŸš€ Run Full Portfolio Optimization</button>
                <div class="loading-spinner" id="portfolioSpinner"></div>
            </div>
            
            <!-- Final Challenge: Board Presentation -->
            <div class="challenge-box">
                <h3>ðŸŽ¤ Final Challenge: Board Presentation</h3>
                <p>The board is waiting. Compile your recommendations and calculate the total business impact.</p>
                
                <div id="finalMetrics" style="display: none;">
                    <h4 style="color: white; margin-bottom: 15px;">Your Achievement:</h4>
                    <div class="metric-cards" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="metric-card" style="background: rgba(255,255,255,0.9);">
                            <div class="metric-value" style="color: #4caf50;">$52.3M</div>
                            <div class="metric-label">Annual Savings</div>
                        </div>
                        <div class="metric-card" style="background: rgba(255,255,255,0.9);">
                            <div class="metric-value" style="color: #4caf50;">97.2%</div>
                            <div class="metric-label">Service Level</div>
                        </div>
                        <div class="metric-card" style="background: rgba(255,255,255,0.9);">
                            <div class="metric-value" style="color: #4caf50;">35%</div>
                            <div class="metric-label">Inventory Reduction</div>
                        </div>
                        <div class="metric-card" style="background: rgba(255,255,255,0.9);">
                            <div class="metric-value" style="color: #4caf50;">425%</div>
                            <div class="metric-label">ROI</div>
                        </div>
                    </div>
                </div>
                
                <button onclick="presentToBoard()">ðŸ“Š Present to Board</button>
            </div>
            
            <!-- Success Message -->
            <div id="successMessage" class="success-message" style="font-size: 1.2em; padding: 30px; text-align: center;">
                <h3>ðŸŽ‰ Congratulations!</h3>
                <p>You've successfully transformed MegaRetail's supply chain!</p>
                <p><strong>Board Decision:</strong> Approved for immediate implementation</p>
                <p><strong>Your Promotion:</strong> Chief Innovation Officer</p>
                <p><strong>Stock Price Impact:</strong> +12% on announcement</p>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize progress
        let progress = 0;
        let decisions = {};
        let optimizationResults = {
            mape: 8.2,
            savings: 0,
            serviceLevel: 95
        };
        
        // Update progress bar
        function updateProgress(increment) {
            progress += increment;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
            
            if (progress >= 100) {
                document.getElementById('successMessage').style.display = 'block';
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Decomposition Chart
            const decompCanvas = document.getElementById('decompositionChart');
            const decompCtx = decompCanvas.getContext('2d');
            decompCanvas.width = 900;
            decompCanvas.height = 400;
            
            drawDecompositionChart(decompCtx);
            
            // Trend Chart
            const trendCanvas = document.getElementById('trendChart');
            const trendCtx = trendCanvas.getContext('2d');
            trendCanvas.width = 900;
            trendCanvas.height = 400;
            
            drawTrendChart(trendCtx);
            
            // Seasonality Chart
            const seasonCanvas = document.getElementById('seasonalityChart');
            const seasonCtx = seasonCanvas.getContext('2d');
            seasonCanvas.width = 900;
            seasonCanvas.height = 400;
            
            drawSeasonalityChart(seasonCtx);
            
            // ARIMA Chart
            const arimaCanvas = document.getElementById('arimaChart');
            const arimaCtx = arimaCanvas.getContext('2d');
            arimaCanvas.width = 900;
            arimaCanvas.height = 400;
            
            drawARIMAChart(arimaCtx);
            
            // Event Impact Chart
            const eventCanvas = document.getElementById('eventChart');
            const eventCtx = eventCanvas.getContext('2d');
            eventCanvas.width = 900;
            eventCanvas.height = 400;
            
            drawEventChart(eventCtx);
            
            // Safety Stock Chart
            const safetyCanvas = document.getElementById('safetyStockChart');
            const safetyCtx = safetyCanvas.getContext('2d');
            safetyCanvas.width = 900;
            safetyCanvas.height = 400;
            
            drawSafetyStockChart(safetyCtx);
            
            // Portfolio Chart
            const portfolioCanvas = document.getElementById('portfolioChart');
            const portfolioCtx = portfolioCanvas.getContext('2d');
            portfolioCanvas.width = 900;
            portfolioCanvas.height = 400;
            
            drawPortfolioChart(portfolioCtx);
        }
        
        // Draw decomposition chart
        function drawDecompositionChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Generate time series data
            const months = 36;
            const data = [];
            const trend = [];
            const seasonal = [];
            const irregular = [];
            
            for (let i = 0; i < months; i++) {
                const t = i / months;
                const trendValue = 100 + 50 * t;
                const seasonalValue = 30 * Math.sin(2 * Math.PI * i / 12);
                const irregularValue = (Math.random() - 0.5) * 20;
                
                trend.push(trendValue);
                seasonal.push(seasonalValue);
                irregular.push(irregularValue);
                data.push(trendValue + seasonalValue + irregularValue);
            }
            
            // Draw components
            const colors = ['#0366d6', '#4caf50', '#ff9800', '#666'];
            const series = [data, trend, seasonal, irregular];
            const labels = ['Original', 'Trend', 'Seasonal', 'Irregular'];
            
            series.forEach((s, idx) => {
                ctx.strokeStyle = colors[idx];
                ctx.lineWidth = idx === 0 ? 3 : 2;
                ctx.beginPath();
                
                s.forEach((value, i) => {
                    const x = 50 + (800 / months) * i;
                    const y = 350 - ((value + 50) / 200) * 300;
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();
            });
            
            // Draw legend
            labels.forEach((label, i) => {
                ctx.fillStyle = colors[i];
                ctx.fillRect(100 + i * 150, 20, 20, 10);
                ctx.fillStyle = '#333';
                ctx.font = '12px Georgia';
                ctx.fillText(label, 130 + i * 150, 30);
            });
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = '14px Georgia';
            ctx.fillText('Sales Volume', 5, 200);
            ctx.fillText('Time (Months)', 400, 390);
        }
        
        // Draw trend chart
        function drawTrendChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Draw trend line with confidence bands
            ctx.strokeStyle = '#0366d6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i < 48; i++) {
                const x = 50 + (800 / 48) * i;
                const y = 350 - (100 + i * 3) * 2;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Draw confidence bands
            ctx.fillStyle = 'rgba(3, 102, 214, 0.1)';
            ctx.beginPath();
            for (let i = 0; i < 48; i++) {
                const x = 50 + (800 / 48) * i;
                const yMid = 350 - (100 + i * 3) * 2;
                const band = 20 + i * 0.5;
                
                if (i === 0) ctx.moveTo(x, yMid - band);
                else ctx.lineTo(x, yMid - band);
            }
            for (let i = 47; i >= 0; i--) {
                const x = 50 + (800 / 48) * i;
                const yMid = 350 - (100 + i * 3) * 2;
                const band = 20 + i * 0.5;
                ctx.lineTo(x, yMid + band);
            }
            ctx.fill();
            
            // Add growth annotation
            ctx.fillStyle = '#4caf50';
            ctx.font = 'bold 16px Georgia';
            ctx.fillText('12% Annual Growth', 650, 100);
            
            // Draw arrow
            ctx.strokeStyle = '#4caf50';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(700, 120);
            ctx.lineTo(750, 70);
            ctx.stroke();
        }
        
        // Draw seasonality chart
        function drawSeasonalityChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Monthly seasonal factors
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                           'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const factors = [0.8, 0.75, 0.85, 0.95, 1.0, 1.1, 
                            1.05, 0.95, 1.1, 1.2, 2.5, 3.0];
            
            // Draw bars
            const barWidth = 60;
            factors.forEach((factor, i) => {
                const x = 70 + i * 65;
                const height = factor * 100;
                const y = 350 - height;
                
                // Color based on intensity
                if (factor > 2) ctx.fillStyle = '#f44336';
                else if (factor > 1.2) ctx.fillStyle = '#ff9800';
                else if (factor > 1) ctx.fillStyle = '#4caf50';
                else ctx.fillStyle = '#2196f3';
                
                ctx.fillRect(x, y, barWidth, height);
                
                // Month labels
                ctx.fillStyle = '#333';
                ctx.font = '12px Georgia';
                ctx.fillText(months[i], x + 20, 370);
                
                // Value labels
                ctx.fillText((factor * 100).toFixed(0) + '%', x + 15, y - 5);
            });
            
            // Highlight holiday season
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(650, 50, 200, 300);
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#f44336';
            ctx.font = 'bold 14px Georgia';
            ctx.fillText('Holiday Surge!', 700, 40);
        }
        
        // Draw ARIMA chart
        function drawARIMAChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            const p = parseInt(document.getElementById('arSlider').value);
            const d = parseInt(document.getElementById('diffSlider').value);
            const q = parseInt(document.getElementById('maSlider').value);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Historical data (36 months)
            const historical = [];
            for (let i = 0; i < 36; i++) {
                const trend = 100 + i * 2;
                const seasonal = 30 * Math.sin(2 * Math.PI * i / 12);
                const noise = (Math.random() - 0.5) * 20;
                historical.push(trend + seasonal + noise);
            }
            
            // Draw historical data
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            historical.forEach((value, i) => {
                const x = 50 + (600 / 36) * i;
                const y = 350 - (value / 200) * 250;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            // Forecast (12 months)
            ctx.strokeStyle = '#0366d6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            const lastValue = historical[historical.length - 1];
            ctx.moveTo(650, 350 - (lastValue / 200) * 250);
            
            for (let i = 0; i < 12; i++) {
                const x = 650 + (200 / 12) * i;
                const forecastValue = lastValue + i * 3 + 20 * Math.sin(2 * Math.PI * i / 12);
                const y = 350 - (forecastValue / 200) * 250;
                ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Confidence intervals
            ctx.fillStyle = 'rgba(3, 102, 214, 0.2)';
            ctx.beginPath();
            
            // Upper bound
            ctx.moveTo(650, 350 - ((lastValue + 20) / 200) * 250);
            for (let i = 0; i < 12; i++) {
                const x = 650 + (200 / 12) * i;
                const forecastValue = lastValue + i * 3 + 20 * Math.sin(2 * Math.PI * i / 12);
                const upperBound = forecastValue + 20 + i * 2;
                const y = 350 - (upperBound / 200) * 250;
                ctx.lineTo(x, y);
            }
            
            // Lower bound
            for (let i = 11; i >= 0; i--) {
                const x = 650 + (200 / 12) * i;
                const forecastValue = lastValue + i * 3 + 20 * Math.sin(2 * Math.PI * i / 12);
                const lowerBound = forecastValue - 20 - i * 2;
                const y = 350 - (lowerBound / 200) * 250;
                ctx.lineTo(x, y);
            }
            ctx.fill();
            
            // Vertical line separator
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(650, 50);
            ctx.lineTo(650, 350);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Labels
            ctx.fillStyle = '#333';
            ctx.font = '14px Georgia';
            ctx.fillText('Historical', 300, 30);
            ctx.fillText('Forecast', 700, 30);
            ctx.fillText(`ARIMA(${p},${d},${q})`, 400, 390);
        }
        
        // Draw event impact chart
        function drawEventChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            const multiplier = parseFloat(document.getElementById('eventSlider').value);
            const rampDays = parseInt(document.getElementById('rampSlider').value);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Normal demand
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(50, 250);
            ctx.lineTo(850, 250);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Event-adjusted demand
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i < 60; i++) {
                const x = 50 + (800 / 60) * i;
                let y;
                
                if (i < 20 - rampDays) {
                    y = 250;
                } else if (i < 20) {
                    const rampProgress = (i - (20 - rampDays)) / rampDays;
                    y = 250 - (multiplier - 1) * 100 * rampProgress;
                } else if (i < 27) {
                    y = 250 - (multiplier - 1) * 100;
                } else if (i < 27 + rampDays) {
                    const rampProgress = 1 - (i - 27) / rampDays;
                    y = 250 - (multiplier - 1) * 100 * rampProgress;
                } else {
                    y = 250;
                }
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Fill area
            ctx.fillStyle = 'rgba(244, 67, 54, 0.1)';
            ctx.beginPath();
            for (let i = 20 - rampDays; i < 27 + rampDays; i++) {
                const x = 50 + (800 / 60) * i;
                let y;
                
                if (i < 20 - rampDays) {
                    y = 250;
                } else if (i < 20) {
                    const rampProgress = (i - (20 - rampDays)) / rampDays;
                    y = 250 - (multiplier - 1) * 100 * rampProgress;
                } else if (i < 27) {
                    y = 250 - (multiplier - 1) * 100;
                } else if (i < 27 + rampDays) {
                    const rampProgress = 1 - (i - 27) / rampDays;
                    y = 250 - (multiplier - 1) * 100 * rampProgress;
                } else {
                    y = 250;
                }
                
                if (i === 20 - rampDays) ctx.moveTo(x, 250);
                ctx.lineTo(x, y);
            }
            ctx.lineTo(50 + (800 / 60) * (27 + rampDays), 250);
            ctx.fill();
            
            // Calculate and display impact
            const baseRevenue = 10000000; // $10M baseline
            const additionalRevenue = baseRevenue * (multiplier - 1) * 0.2; // 20% of spike captured
            const lostRevenue = multiplier < 5 ? (5 - multiplier) * 2000000 : 0;
            const netImpact = additionalRevenue - lostRevenue;
            
            document.getElementById('eventImpact').textContent = 
                `Impact: ${netImpact > 0 ? '+' : ''}$${(netImpact / 1000000).toFixed(1)}M`;
            
            // Event marker
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50 + (800 / 60) * 23.5, 50);
            ctx.lineTo(50 + (800 / 60) * 23.5, 350);
            ctx.stroke();
            
            ctx.fillStyle = '#f44336';
            ctx.font = 'bold 14px Georgia';
            ctx.fillText('Black Friday', 50 + (800 / 60) * 23.5 - 40, 40);
        }
        
        // Draw safety stock chart
        function drawSafetyStockChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            const serviceLevel = parseFloat(document.getElementById('serviceSlider').value);
            const leadTime = parseInt(document.getElementById('leadSlider').value);
            const holdingCost = parseFloat(document.getElementById('holdingSlider').value);
            
            // Calculate Z-score
            const zScore = getZScore(serviceLevel / 100);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Draw dynamic safety stock over time
            ctx.strokeStyle = '#4caf50';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i < 52; i++) {
                const x = 50 + (800 / 52) * i;
                const seasonal = 1 + 0.5 * Math.sin(2 * Math.PI * i / 52);
                const dynamicStock = 50 * zScore * Math.sqrt(leadTime) * seasonal;
                const y = 350 - (dynamicStock / 200) * 250;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Draw traditional fixed safety stock
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            const fixedStock = 100 * zScore * Math.sqrt(leadTime);
            const fixedY = 350 - (fixedStock / 200) * 250;
            ctx.beginPath();
            ctx.moveTo(50, fixedY);
            ctx.lineTo(850, fixedY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Fill savings area
            ctx.fillStyle = 'rgba(76, 175, 80, 0.1)';
            ctx.beginPath();
            ctx.moveTo(50, fixedY);
            for (let i = 0; i < 52; i++) {
                const x = 50 + (800 / 52) * i;
                const seasonal = 1 + 0.5 * Math.sin(2 * Math.PI * i / 52);
                const dynamicStock = 50 * zScore * Math.sqrt(leadTime) * seasonal;
                const y = 350 - (dynamicStock / 200) * 250;
                ctx.lineTo(x, y);
            }
            ctx.lineTo(850, fixedY);
            ctx.fill();
            
            // Update metrics
            const avgDynamicStock = 50 * zScore * Math.sqrt(leadTime);
            const stockValue = avgDynamicStock * 10000; // $10K per unit
            const annualHolding = stockValue * (holdingCost / 100);
            const savings = (fixedStock - avgDynamicStock) * 10000 * (holdingCost / 100);
            
            document.getElementById('stockValue').textContent = `$${(stockValue / 1000).toFixed(0)}K`;
            document.getElementById('stockoutRisk').textContent = `${(100 - serviceLevel).toFixed(1)}%`;
            document.getElementById('holdingCost').textContent = `$${(annualHolding / 1000).toFixed(0)}K`;
            document.getElementById('savingsValue').textContent = `$${(savings / 1000000 * 1000).toFixed(0)}M`;
            
            // Legend
            ctx.font = '12px Georgia';
            ctx.fillStyle = '#4caf50';
            ctx.fillRect(100, 20, 20, 10);
            ctx.fillText('Dynamic Safety Stock', 130, 30);
            
            ctx.fillStyle = '#f44336';
            ctx.fillRect(300, 20, 20, 10);
            ctx.fillText('Traditional Fixed Stock', 330, 30);
            
            // Savings annotation
            ctx.fillStyle = '#4caf50';
            ctx.font = 'bold 14px Georgia';
            ctx.fillText('Savings Area', 400, 200);
        }
        
        // Draw portfolio optimization chart
        function drawPortfolioChart(ctx) {
            ctx.clearRect(0, 0, 900, 400);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 350);
            ctx.lineTo(850, 350);
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.stroke();
            
            // Categories
            const categories = ['Electronics', 'Clothing', 'Grocery', 'Home'];
            const values = [6000, 5000, 4000, 5000];
            const optimized = [4200, 3500, 3200, 3500];
            
            const barWidth = 80;
            const groupWidth = 200;
            
            categories.forEach((cat, i) => {
                const x = 100 + i * groupWidth;
                
                // Current inventory
                ctx.fillStyle = '#f44336';
                const currentHeight = (values[i] / 10000) * 250;
                ctx.fillRect(x, 350 - currentHeight, barWidth, currentHeight);
                
                // Optimized inventory
                ctx.fillStyle = '#4caf50';
                const optHeight = (optimized[i] / 10000) * 250;
                ctx.fillRect(x + barWidth + 10, 350 - optHeight, barWidth, optHeight);
                
                // Labels
                ctx.fillStyle = '#333';
                ctx.font = '12px Georgia';
                ctx.fillText(cat, x + 30, 370);
                
                // Values
                ctx.fillText(`${values[i]}`, x + 25, 350 - currentHeight - 5);
                ctx.fillText(`${optimized[i]}`, x + barWidth + 35, 350 - optHeight - 5);
            });
            
            // Legend
            ctx.fillStyle = '#f44336';
            ctx.fillRect(650, 50, 20, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Current', 680, 60);
            
            ctx.fillStyle = '#4caf50';
            ctx.fillRect(650, 70, 20, 10);
            ctx.fillStyle = '#333';
            ctx.fillText('Optimized', 680, 80);
            
            // Title
            ctx.font = 'bold 14px Georgia';
            ctx.fillText('SKU Count by Category', 350, 30);
        }
        
        // Helper function for Z-score calculation
        function getZScore(probability) {
            // Approximation of inverse normal CDF
            const a = [2.50662823884, -18.61500062529, 41.39119773534, -25.44106049637];
            const b = [-8.47351093090, 23.08336743743, -21.06224101826, 3.13082909833];
            const c = [0.3374754822726147, 0.9761690190917186, 0.1607979714918209, 
                      0.0276438810333863, 0.0038405729373609, 0.0003951896511919, 
                      0.0000321767881768, 0.0000002888167364, 0.0000003960315187];
            
            const p = probability;
            const q = p - 0.5;
            let r, z;
            
            if (Math.abs(q) < 0.425) {
                r = 0.180625 - q * q;
                z = q * (((a[3] * r + a[2]) * r + a[1]) * r + a[0]) /
                        ((((b[3] * r + b[2]) * r + b[1]) * r + b[0]) * r + 1);
            } else {
                if (q > 0) r = 1 - p;
                else r = p;
                
                r = Math.sqrt(-Math.log(r));
                
                if (r < 5) {
                    r = r - 1.6;
                    z = ((((((c[7] * r + c[6]) * r + c[5]) * r + c[4]) * r + c[3]) * r + c[2]) * r + c[1]) * r + c[0];
                } else {
                    r = r - 5;
                    z = ((((((c[7] * r + c[6]) * r + c[5]) * r + c[4]) * r + c[3]) * r + c[2]) * r + c[1]) * r + c[0];
                }
                
                if (q < 0) z = -z;
            }
            
            return z;
        }
        
        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            updateProgress(5);
        }
        
        // Decision making
        function makeDecision(choice, decisionNumber) {
            decisions[`decision${decisionNumber}`] = choice;
            
            let feedback = '';
            let isCorrect = false;
            
            if (decisionNumber === 1) {
                if (choice === 'seasonal') {
                    feedback = 'âœ“ Correct! Seasonal spikes of 300% are the primary driver of inventory problems. This insight will save $25M annually.';
                    isCorrect = true;
                    optimizationResults.savings += 25;
                } else if (choice === 'trend') {
                    feedback = 'Partially correct. The growing trend is important for capacity planning but not the main inventory issue.';
                    optimizationResults.savings += 10;
                } else {
                    feedback = 'Random fluctuations are manageable with safety stock. Focus on the predictable patterns first.';
                    optimizationResults.savings += 5;
                }
                
                const feedbackDiv = document.getElementById('decision1Feedback');
                feedbackDiv.textContent = feedback;
                feedbackDiv.style.display = 'block';
                if (!isCorrect) feedbackDiv.className = 'warning-message';
                
            } else if (decisionNumber === 2) {
                if (choice === 'balanced') {
                    feedback = 'âœ“ Excellent choice! 95% service level optimally balances customer satisfaction with inventory costs.';
                    isCorrect = true;
                    optimizationResults.savings += 30;
                    optimizationResults.serviceLevel = 95;
                } else if (choice === 'aggressive') {
                    feedback = 'Risky but potentially rewarding. Monitor customer complaints closely.';
                    optimizationResults.savings += 40;
                    optimizationResults.serviceLevel = 90;
                } else {
                    feedback = 'Conservative approach. Safe but leaves money on the table.';
                    optimizationResults.savings += 20;
                    optimizationResults.serviceLevel = 99;
                }
                
                const feedbackDiv = document.getElementById('decision2Feedback');
                feedbackDiv.textContent = feedback;
                feedbackDiv.style.display = 'block';
                if (isCorrect) feedbackDiv.className = 'success-message';
            }
            
            updateProgress(10);
        }
        
        // Optimize ARIMA
        function optimizeARIMA() {
            document.getElementById('optimizingSpinner').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('arSlider').value = 2;
                document.getElementById('diffSlider').value = 1;
                document.getElementById('maSlider').value = 1;
                document.getElementById('seasonalPeriod').value = '30';
                
                document.getElementById('arValue').textContent = '2';
                document.getElementById('diffValue').textContent = '1';
                document.getElementById('maValue').textContent = '1';
                
                document.getElementById('mapeValue').textContent = '5.3%';
                document.getElementById('aicValue').textContent = '1654.2';
                
                optimizationResults.mape = 5.3;
                
                drawARIMAChart(document.getElementById('arimaChart').getContext('2d'));
                
                document.getElementById('optimizingSpinner').style.display = 'none';
                updateProgress(15);
            }, 2000);
        }
        
        // Run portfolio optimization
        function runPortfolioOptimization() {
            document.getElementById('portfolioSpinner').style.display = 'block';
            
            let optimizedCount = 0;
            const interval = setInterval(() => {
                optimizedCount += 1000;
                document.getElementById('optimizedSKUs').textContent = 
                    optimizedCount.toLocaleString();
                
                const savings = (optimizedCount / 20000) * 50;
                document.getElementById('portfolioSavings').textContent = 
                    `$${savings.toFixed(1)}M`;
                
                if (optimizedCount >= 20000) {
                    clearInterval(interval);
                    document.getElementById('portfolioSpinner').style.display = 'none';
                    updateProgress(20);
                }
            }, 100);
        }
        
        // Show hint
        function showHint(hintType) {
            document.getElementById(`${hintType}Hint`).style.display = 'block';
        }
        
        // Present to board
        function presentToBoard() {
            document.getElementById('finalMetrics').style.display = 'block';
            updateProgress(25);
            
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'block';
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 2000);
        }
        
        // Slider updates
        document.getElementById('smoothingSlider').addEventListener('input', (e) => {
            document.getElementById('smoothingValue').textContent = e.target.value + ' months';
            drawDecompositionChart(document.getElementById('decompositionChart').getContext('2d'));
        });
        
        document.getElementById('arSlider').addEventListener('input', (e) => {
            document.getElementById('arValue').textContent = e.target.value;
            drawARIMAChart(document.getElementById('arimaChart').getContext('2d'));
        });
        
        document.getElementById('diffSlider').addEventListener('input', (e) => {
            document.getElementById('diffValue').textContent = e.target.value;
            drawARIMAChart(document.getElementById('arimaChart').getContext('2d'));
        });
        
        document.getElementById('maSlider').addEventListener('input', (e) => {
            document.getElementById('maValue').textContent = e.target.value;
            drawARIMAChart(document.getElementById('arimaChart').getContext('2d'));
        });
        
        document.getElementById('eventSlider').addEventListener('input', (e) => {
            document.getElementById('eventValue').textContent = e.target.value + 'x';
            drawEventChart(document.getElementById('eventChart').getContext('2d'));
        });
        
        document.getElementById('rampSlider').addEventListener('input', (e) => {
            document.getElementById('rampValue').textContent = e.target.value + ' days';
            drawEventChart(document.getElementById('eventChart').getContext('2d'));
        });
        
        document.getElementById('serviceSlider').addEventListener('input', (e) => {
            document.getElementById('serviceValue').textContent = e.target.value + '%';
            drawSafetyStockChart(document.getElementById('safetyStockChart').getContext('2d'));
        });
        
        document.getElementById('leadSlider').addEventListener('input', (e) => {
            document.getElementById('leadValue').textContent = e.target.value + ' days';
            drawSafetyStockChart(document.getElementById('safetyStockChart').getContext('2d'));
        });
        
        document.getElementById('holdingSlider').addEventListener('input', (e) => {
            document.getElementById('holdingValue').textContent = e.target.value + '%';
            drawSafetyStockChart(document.getElementById('safetyStockChart').getContext('2d'));
        });
        
        // Initialize on load
        window.onload = () => {
            initializeCharts();
            updateProgress(5);
        };
    </script>
</body>
</html>